もう一方のツールである **rsync ファイル同期プロジェクト** についても、ご提示いただいたフォーマットと、GitHub上の標準的なベストプラクティスを反映してゼロから書き直しました。

特に「前提条件」の明記と、「準備手順」における設定ファイルの具体例を肉付けし、誰でもすぐに実行可能な状態へブラッシュアップしています。

---

# rsync ファイル同期プロジェクト

## 概要

リモートサーバから特定のファイルを `rsync` を用いて取得する自動化ツールです。
SSH鍵が登録できない環境でも動作するよう、`pexpect` によるパスワード自動入力をサポートしています。また、`--itemize-changes` オプションにより、**実際にダウンロードされたファイルのみ**を抽出してログに記録することが可能です。

## ディレクトリ構成

```text
project_name/
├── data/              # データ管理
│   ├── raw/           # 元データ（転送後の一次データ：読み取り専用）
│   ├── interim/       # 中間処理（掃除中・変換中のデータ）
│   └── processed/     # 加工済みデータ（分析にそのまま使える完成品）
├── lib/               # 共通自作関数（.py）
│   ├── rsync_utils.py # 同期処理本体（CLI実行対応）
│   └── logger_config.py # 共通ロギング設定
├── param/             # 分析設定
│   ├── config/        # パラメータファイルの保存先（テンプレート等）
│   └── cmd/           # 外部コマンドテンプレート
├── result/           # 成果物（実行結果、差分リスト、ログ）
├── vault/             # 【秘匿情報】config.json 等（Git管理外）
├── .gitignore         # data/ や vault/ を管理対象外に設定
├── README.md          # 本ドキュメント
└── 01_rsync-download.ipynb # 手動実行・疎通確認用Notebook

```

### 各ディレクトリの説明

* **data/**: リモートから取得したファイルを格納します。
* `raw/`: 取得したままの状態を維持（絶対に変更しない / 読み取り専用）。
* `interim/` / `processed/`: 取得後のパース作業や整形データ用。


* **lib/**: 同期ロジックやロギング設定を格納。CLI実行とNotebook実行で共通のロジックを使用します。
* **param/**: 同期対象のリストやフィルタ設定などのテンプレートを管理。
* **vault/**: 接続先の生IPやログインパスワード（`config.json`）を格納。セキュリティのため、Git管理からは除外します。
* **result/**: 実行の都度生成される同期ログや、転送ファイルリストが蓄積されます。

---

## 前提条件 (Prerequisites)

* **Python環境**: Python 3.8 以上
* **OS**: Linux / macOS (rsyncコマンドがインストールされていること)
* **必要ライブラリ**:
```bash
pip install pexpect

```



---

## 準備手順 (Setup)

実行前に以下のステップを完了させてください。

### 1. 接続・同期設定の作成 (`vault/config.json`)

セキュリティの観点から `vault/` 内にパスワードを含む設定ファイルを作成します。

```json
{
  "REMOTE_USER": "username",
  "REMOTE_HOST": "192.168.x.x",
  "PASSWORD": "your_password",
  "SRC_DIR": "/home/user/logs/",
  "DEST_DIR": "./data/raw/",
  "BW_LIMIT": "2000",
  "EXT_FILTER": "--include='*.log' --exclude='*'"
}

```

### 2. 環境の確認

`result/` ディレクトリが存在することを確認してください。存在しない場合は、実行時に自動生成されます。

---

## 実行方法 (Usage)

### 1. Jupyter Notebook からの実行

`01_rsync-download.ipynb` を開き、以下のセルを順に実行してください。

* 疎通確認や、特定のタイミングで手動同期を行いたい場合に適しています。

### 2. コマンドライン（CLI）からの直接実行

サーバー上で直接、または外部スケジューラから実行する場合に使用します。

```bash
# プロジェクトルートへ移動
$ cd /path/to/project_name/

# 実行
$ python3 lib/rsync_utils.py

```

### 3. CRON による定期実行

毎日深夜 02:00 に自動実行する場合の設定例です（`crontab -e`）。

```text
00 02 * * * cd /path/to/project_name && /usr/bin/python3 lib/rsync_utils.py

```

---

## モジュール仕様

### `lib/rsync_utils.py`

#### `rsync_pull(conf)`

* **目的**: 設定辞書に基づき `rsync` を実行し、新規ダウンロードファイルのみを抽出してログに記録。
* **引数**: `conf (dict)` (接続情報、ディレクトリパス、帯域制限、フィルタ設定)
* **返り値**: `str` (実行結果メッセージ)

---

## セキュリティ・トラブルシューティング

* **Security**: `vault/` および `data/` は機密情報を含むため、絶対にコミットしないでください。
* **rsync Error**: 接続エラーが発生する場合は、実行端末からターゲットへ手動で `ssh` ログインが可能か（疎通と権限）を確認してください。
* **.gitignore**: 以下の設定が有効であることを確認してください。
```text
vault/
data/
result/
__pycache__/

```